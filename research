#!/usr/bin/env bash
# Project Researcher - wrapper script
set -e

# Resolve symlinks to get the actual script location
SOURCE="${BASH_SOURCE[0]}"
while [ -L "$SOURCE" ]; do
    DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
    SOURCE="$(readlink "$SOURCE")"
    [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
VENV_PYTHON="$SCRIPT_DIR/venv/bin/python"

if [[ ! -f "$VENV_PYTHON" ]]; then
    echo "Setting up virtual environment..."
    python3 -m venv "$SCRIPT_DIR/venv"
    "$VENV_PYTHON" -m pip install -q -r "$SCRIPT_DIR/requirements.txt"
fi

exec "$VENV_PYTHON" "$SCRIPT_DIR/agent.py" "$@"
